<h1>Google Maps Test</h1>
<div id="map-container">
  <div id="map-canvas"></div>
</div>


<%= @state.name %>

<% @state.breweries.each do |brewery| %>
  <ul>
    <li>
       <%= link_to brewery.name, state_brewery_path(@state, brewery) %>
     </li>
   </ul>
<% end %>


<script type="text/javascript"
  src= <%= @map_api_call %> >
</script>
<script type="text/javascript">
  var geocoder;
  var map;
  function initialize() {
  geocoder = new google.maps.Geocoder();
  codeAddress();
  var latlng = new google.maps.LatLng(-34.397, 150.644);
  var mapOptions = {
    zoom: 6,
    center: latlng
  }
  map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);
  }

  function codeAddress() {
    var state = " <%= @state.name %> ";
    geocoder.geocode( { 'address': state}, function(results, status) {

    var ne = results[0].geometry.viewport.getNorthEast();
    var sw = results[0].geometry.viewport.getSouthWest();

    var bounds = new google.maps.LatLngBounds(sw, ne);
    map.setCenter(bounds.getCenter());

    if (status == google.maps.GeocoderStatus.OK) {
      map.setCenter(results[0].geometry.location);
      var marker = new google.maps.Marker({
          map: map,
          position: results[0].geometry.location
      });
    } else {
      alert("Geocode was not successful for the following reason: " + status);
    }
  });
  }

  function loadScript() {
   var script = document.createElement('script');
   script.type = 'text/javascript';
   script.src = 'https://maps.googleapis.com/maps/api/js?v=3.exp' +
       '&signed_in=true&callback=initialize';
   document.body.appendChild(script);
  }

  window.onload = loadScript;
</script>
